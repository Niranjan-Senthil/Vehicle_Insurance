@using Microsoft.AspNetCore.Identity;
@using VehicleInsuranceProject.Repository.Models;
@inject UserManager<IdentityUser> UserManager;
@inject SignInManager<IdentityUser> SignInManager;

@model VehicleInsuranceProject.Repository.Models.Customer

@{
    ViewData["Title"] = "Customer Dashboard";
    // Get the display name for the welcome message:
    // 1. Try to use the Customer's Name from the Model (which should be populated)
    // 2. Fallback to IdentityUser's UserName (which is their email)
    // 3. Fallback to a generic phrase.
    var welcomeName = Model?.Name ?? UserManager.GetUserName(User) ?? "VehicleInsurancePro User";
}

@section Head {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
}

@* All inline styles have been moved to wwwroot/css/site.css *@

<div class="container dashboard-container">
    <h2 class="mb-5">Welcome, @welcomeName!</h2>

    @* Display Success/Error Messages using TempData *@
    @if (TempData["WelcomeMessage"] != null)
    {
        <div class="alert welcome-alert alert-dismissible fade show" role="alert">
            <i class="bi bi-hand-thumbs-up-fill me-2"></i> @TempData["WelcomeMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show mt-4" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show mt-4" role="alert">
            <i class="bi bi-x-circle-fill me-2"></i> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-2 g-4">
        <div class="col">
            <div class="card card-dashboard text-center shadow">
                <div class="card-body">
                    <i class="bi bi-car-front-fill card-icon card-vehicles"></i>
                    <h5 class="card-title">My Vehicles</h5>
                    <p class="card-text">View and manage all your registered vehicles.</p>
                    <a asp-controller="Vehicle" asp-action="ViewVehicles" class="btn dashboard-link-btn"> @* Using custom class *@
                        <i class="bi bi-list-check me-2"></i> Manage Vehicles
                    </a>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card card-dashboard text-center shadow">
                <div class="card-body">
                    <i class="bi bi-exclamation-triangle-fill card-icon card-claims"></i>
                    <h5 class="card-title">My Claims</h5>
                    <p class="card-text">Track the status of your insurance claims and submit new ones.</p>
                    <a asp-controller="Claims" asp-action="CustomerClaims" class="btn dashboard-link-btn"> @* Using custom class *@
                        <i class="bi bi-clipboard-data me-2"></i> View Claims
                    </a>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card card-dashboard text-center shadow">
                <div class="card-body">
                    <i class="bi bi-person-badge-fill card-icon card-profile"></i>
                    <h5 class="card-title">My Profile</h5>
                    <p class="card-text">Update your personal information and contact details.</p>
                    <a asp-controller="Customer" asp-action="Details" class="btn dashboard-link-btn"> @* Using custom class *@
                        <i class="bi bi-pencil-square me-2"></i> Edit Profile
                    </a>
                </div>
            </div>
        </div>

        <!-- NEW: My Reports Card for Customers -->
        <div class="col">
            <div class="card card-dashboard text-center shadow">
                <div class="card-body">
                    <i class="bi bi-bar-chart-line-fill card-icon card-setting"></i> <!-- Icon for reports -->
                    <h5 class="card-title">My Reports</h5>
                    <p class="card-text">View detailed reports on your policies and claims.</p>
                    <a asp-controller="Report" asp-action="Index" class="btn btn-secondary dashboard-link-btn">
                        <i class="bi bi-file-earmark-bar-graph me-2"></i> View My Reports
                    </a>
                </div>
            </div>
        </div>




        @* Added a new card type for policies for completeness, assuming you might have one. *@
        <div class="col">
            <div class="card card-dashboard text-center shadow">
                <div class="card-body">
                    <i class="bi bi-file-earmark-text-fill card-icon card-policy"></i>
                    <h5 class="card-title">My Policies</h5>
                    <p class="card-text">Review your active and past insurance policies.</p>
                    <a asp-controller="Policy" asp-action="ViewPolicies" class="btn dashboard-link-btn"> @* Using custom class *@
                        <i class="bi bi-journal-check me-2"></i> View Policies
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="recent-activity-section">
        <h3><i class="bi bi-activity me-3"></i>Your Vehicles & Recent Activity</h3>
        @if (Model != null && Model.Vehicles != null && Model.Vehicles.Any())
        {
            <div class="table-responsive mt-4">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Registration Number</th>
                            <th>Make</th>
                            <th>Model</th>
                            <th>Year</th>
                            <th>Type</th>
                            @* <th class="text-center">Actions</th> *@
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var vehicle in Model.Vehicles.OrderByDescending(v => v.vehicleId))
                        {
                            <tr>
                                <td>@vehicle.registrationNumber</td>
                                <td>@vehicle.make</td>
                                <td>@vehicle.model</td>
                                <td>@vehicle.yearOfManufacture</td>
                                <td>@vehicle.vehicleType</td>
                                @* <td class="text-center"> *@
                                    @* <a asp-controller="Vehicle" asp-action="Edit" asp-route-vehicleId="@vehicle.vehicleId" class="btn btn-sm btn-outline-insure-primary me-2"> *@
                                    @*     <i class="bi bi-pencil"></i> Edit *@
                                    @* </a> *@
                                    @* Add a delete button with confirmation if you implement a Delete action in VehicleController *@
                                    @* <a asp-controller="Vehicle" asp-action="Delete" asp-route-vehicleId="@vehicle.vehicleId" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this vehicle?');">
                                        <i class="bi bi-trash"></i> Delete
                                    </a> *@
                                @* </td> *@
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="text-center mt-4">
                <a asp-controller="Vehicle" asp-action="Add" class="btn btn-insure-primary btn-lg"> @* Using custom class *@
                    <i class="bi bi-plus-circle me-2"></i> Add New Vehicle
                </a>
            </div>
        }
        else
        {
            <div class="empty-state-section">
                <i class="bi bi-car-front-fill"></i>
                <p>You haven't added any vehicles yet. Let's get you set up!</p>
                <a asp-controller="Vehicle" asp-action="Add" class="btn btn-insure-primary btn-lg mt-3"> @* Using custom class *@
                    <i class="bi bi-plus-circle-fill me-2"></i> Add Your First Vehicle
                </a>
            </div>
        }

        
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Auto-hide success/error messages after a few seconds
        $(document).ready(function() {
            setTimeout(function() {
                $(".alert-dismissible").fadeTo(500, 0).slideUp(500, function(){
                    $(this).remove();
                });
            }, 7000); // 7 seconds
        });
    </script>
}