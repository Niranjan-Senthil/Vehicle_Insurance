@using Microsoft.AspNetCore.Identity;
@using VehicleInsuranceProject.Repository.Models;
@inject UserManager<IdentityUser> UserManager;
@inject SignInManager<IdentityUser> SignInManager;
@* Corrected: Ensure standard Identity manager is injected *@

@model VehicleInsuranceProject.Repository.Models.Customer

@{
    ViewData["Title"] = "Customer Dashboard";
    var welcomeName = Model?.Name ?? UserManager.GetUserName(User) ?? "Insurance Customer";
}

@section Head {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    @* Ensure your custom CSS file is linked *@
    <link rel="stylesheet" href="~/css/site.css" /> 
}

<div class="container py-5 dashboard-container-bg">
    <h2 class="text-center mb-5 display-4 fw-bold text-dark">Welcome Back, <span class="text-insure-mid-purple">@welcomeName</span>!</h2>

    @* Display Success/Error Messages using TempData *@
    @if (TempData.ContainsKey("WelcomeMessage"))
    {
        <div class="alert welcome-alert alert-dismissible fade show text-center shadow-sm" role="alert">
            <i class="bi bi-hand-thumbs-up-fill me-2"></i> @TempData["WelcomeMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData.ContainsKey("SuccessMessage"))
    {
        <div class="alert alert-success alert-dismissible fade show text-center shadow-sm mt-4" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData.ContainsKey("ErrorMessage"))
    {
        <div class="alert alert-danger alert-dismissible fade show text-center shadow-sm mt-4" role="alert">
            <i class="bi bi-x-circle-fill me-2"></i> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @* Only showing the core 5 cards requested by the user *@
    <div class="row row-cols-1 row-cols-md-3 g-4 mt-5 justify-content-center">
        
        @* Card 1: My Vehicles - Blue theme *@
        <div class="col">
            <div class="dashboard-card card-theme-blue shadow-sm rounded-5 p-4 text-center h-100">
                <i class="bi bi-car-front-fill dashboard-card-icon mb-3"></i> 
                <h5 class="card-title fw-bold text-dark mb-2">My Vehicles</h5>
                <p class="card-text small mb-4">View and manage all your registered vehicles.</p>
                <a asp-controller="Vehicle" asp-action="ViewVehicles" class="btn btn-outline-primary btn-sm rounded-pill w-75 dashboard-btn">
                    <i class="bi bi-list-check me-2"></i> Manage Vehicles
                </a>
            </div>
        </div>

        @* Card 2: My Claims - Green theme *@
        <div class="col">
            <div class="dashboard-card card-theme-green shadow-sm rounded-5 p-4 text-center h-100">
                <i class="bi bi-file-earmark-medical-fill dashboard-card-icon mb-3"></i>
                <h5 class="card-title fw-bold text-dark mb-2">My Claims</h5>
                <p class="card-text small mb-4">Track the status of your insurance claims and submit new ones.</p>
                <a asp-controller="Claims" asp-action="CustomerClaims" class="btn btn-outline-success btn-sm rounded-pill w-75 dashboard-btn">
                    <i class="bi bi-clipboard-data me-2"></i> View Claims
                </a>
            </div>
        </div>

        @* Card 3: My Profile - Cyan/Info theme *@
        <div class="col">
            <div class="dashboard-card card-theme-cyan shadow-sm rounded-5 p-4 text-center h-100">
                <i class="bi bi-person-fill dashboard-card-icon mb-3"></i>
                <h5 class="card-title fw-bold text-dark mb-2">My Profile</h5>
                <p class="card-text small mb-4">Update your personal information and contact details.</p>
                <a asp-controller="Customer" asp-action="Details" class="btn btn-outline-info btn-sm rounded-pill w-75 dashboard-btn">
                    <i class="bi bi-pencil-square me-2"></i> Edit Profile
                </a>
            </div>
        </div>
        
        @* Card 4: My Reports - Yellow/Warning theme *@
        <div class="col">
            <div class="dashboard-card card-theme-yellow shadow-sm rounded-5 p-4 text-center h-100">
                <i class="bi bi-bar-chart-line-fill dashboard-card-icon mb-3"></i>
                <h5 class="card-title fw-bold text-dark mb-2">My Reports</h5>
                <p class="card-text small mb-4">View detailed reports on your policies and claims.</p>
                <a asp-controller="Report" asp-action="Index" class="btn btn-outline-warning btn-sm rounded-pill w-75 dashboard-btn">
                    <i class="bi bi-file-earmark-bar-graph me-2"></i> View My Reports
                </a>
            </div>
        </div>

        @* Card 5: My Policies - Red/Danger theme *@
        <div class="col">
            <div class="dashboard-card card-theme-red shadow-sm rounded-5 p-4 text-center h-100">
                <i class="bi bi-file-earmark-text-fill dashboard-card-icon mb-3"></i>
                <h5 class="card-title fw-bold text-dark mb-2">My Policies</h5>
                <p class="card-text small mb-4">Review your active and past insurance policies.</p>
                <a asp-controller="Policy" asp-action="ViewPolicies" class="btn btn-outline-danger btn-sm rounded-pill w-75 dashboard-btn">
                    <i class="bi bi-journal-check me-2"></i> View Policies
                </a>
            </div>
        </div>
        
    </div>

</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function() {
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })

            // Auto-dismiss alerts
            setTimeout(function() {
                $(".alert-dismissible").fadeTo(500, 0).slideUp(500, function(){
                    $(this).remove();
                });
            }, 7000); // 7 seconds
        });
    </script>
}

<style>
    /* ---------------------------------------------------- */
    /* INLINE STYLES FOR GUARANTEED VISUAL APPEARANCE       */
    /* Card borders have been removed, but background and   */
    /* icon colors remain for distinction.                  */
    /* ---------------------------------------------------- */

    /* Custom Text Color */
    .text-insure-mid-purple {
        color: black; /* Deep violet color */
    }

    /* Base Card Style Update: Removed explicit border */
    .dashboard-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-radius: 1.5rem !important; 
        /* Removed border property */
    }

    /* Card Themes: Only background colors remain */
    .card-theme-blue {
        background-color: #f0f7ff; 
    }
    
    .card-theme-green {
        background-color: #f3fff5; 
    }

    .card-theme-cyan {
        background-color: #f0faff; 
    }

    .card-theme-yellow {
        background-color: #fffbf0; 
    }

    .card-theme-red {
        background-color: #fff0f1; 
    }
    
    /* Icon Styling: Colors preserved */
    .dashboard-card-icon {
        font-size: 3rem;
    }

    .card-theme-blue .dashboard-card-icon {
        color: #007bff;
    }
    
    .card-theme-green .dashboard-card-icon {
        color: #28a745;
    }

    .card-theme-cyan .dashboard-card-icon {
        color: #17a2b8;
    }

    .card-theme-yellow .dashboard-card-icon {
        color: #ffc107;
    }

    .card-theme-red .dashboard-card-icon {
        color: #dc3545;
    }
    
    /* Hover effect for buttons on the cards */
    .dashboard-btn:hover {
        opacity: 0.85;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* ---------------------------------------------------- */
    /* General Layout Styles       */
    /* ---------------------------------------------------- */
    
    body {
        background-color: white !important; /* Changed to a slightly darker, more intense gray */
    }

    .dashboard-container-bg {
        border-radius: 2rem; 
        padding-top: 3rem !important; 
        padding-bottom: 3rem !important;
        margin-top: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
    }

    .dashboard-card:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
    }


    /* Custom welcome alert theme - CHANGED TO GREEN */
    .welcome-alert {
        background-color: #e6ffe6; 
        border-color: #b3ffb3; 
        color: #008000; 
        font-weight: 600;
        border-radius: 1rem;
    }
    
    /* Ensuring table head colors are visible/readable */
    .table thead.bg-dark th {
        color: white;
    }
</style>
