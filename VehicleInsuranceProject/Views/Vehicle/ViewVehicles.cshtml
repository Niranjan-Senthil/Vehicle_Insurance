@model IEnumerable<VehicleInsuranceProject.Repository.Models.Vehicle>

@{
    ViewData["Title"] = "My Vehicles";
    Layout = "~/Views/Shared/_Layout.cshtml"; // Ensure your layout is correctly referenced
}

<style>
    /* ------------------------------------------------------------------ */
    /* POLISURE VIBRANT BLUE/PURPLE THEME STYLES                          */
    /* ------------------------------------------------------------------ */
    
    /* Custom Color Definitions for this page (Matching the reference images) */
    :root {
        --theme-primary-blue: #3F51B5;     /* Main action and accent color (Indigo) */
        --theme-dark-blue: #303F9F;        /* Darker primary color (Table Header) */
        --theme-bg-light: #f4f6f9;         /* Very light dashboard background */
        --theme-text-dark: #2c3e50;        /* Main content text color */
        --theme-text-light: #7f8c8d;       /* Secondary/muted text */
        --theme-border-light: #ecf0f1;     /* Subtle border */
        --theme-danger-red: #E74C3C;       /* Clean error red */
        --theme-success-green: #2ECC71;    /* Clean success green */
    }

    /* Global Body Styling */
    body {
        background-color: var(--theme-bg-light); 
        font-family: 'Inter', sans-serif;
        color: var(--theme-text-dark);
    }

    /* Main Container for the Page Content (Minimalist Card) */
    .vehicles-main-card {
        max-width: 1100px;
        margin: 40px auto;
        padding: 50px; /* Increased padding */
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.05); /* Soft, hovering shadow */
        border: 1px solid var(--theme-border-light); 
    }

    /* Page Heading Block (Centered with Icon) */
    .header-block {
        text-align: center;
        margin-bottom: 40px;
    }

    .header-icon {
        font-size: 3.5rem;
        color: var(--theme-primary-blue);
        margin-bottom: 15px;
        display: block;
    }

    .header-block h2 {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--theme-dark-blue); 
        margin-bottom: 5px;
    }
    
    .header-block p {
        color: var(--theme-text-light);
        font-size: 1rem;
    }

    /* Add New Vehicle Button (Primary Blue) */
    .btn-add-vehicle {
        background-color: var(--theme-primary-blue); 
        border-color: var(--theme-primary-blue); 
        color: #fff; 
        padding: 0.8rem 1.6rem;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 6px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(63, 81, 181, 0.4); 
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-transform: uppercase;
    }

    .btn-add-vehicle:hover {
        background-color: var(--theme-dark-blue);
        border-color: var(--theme-dark-blue);
        transform: translateY(-2px); 
        box-shadow: 0 6px 15px rgba(63, 81, 181, 0.6); 
        color: #fff;
    }

    /* Table Styling */
    .table-responsive {
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--theme-border-light);
    }

    .table {
        margin-top: 0;
        border-collapse: separate;
    }

    .table thead th {
        /* Darker Blue Header */
        background-color: var(--theme-dark-blue); 
        color: #ffffff; 
        font-weight: 600;
        padding: 1rem 1.25rem;
        border: none;
        text-align: left; 
    }

    .table tbody tr {
        background-color: #ffffff;
        transition: background-color 0.2s ease;
    }

    .table tbody tr:hover {
        /* Subtle light blue hover */
        background-color: #fafbfe; 
    }

    .table tbody td {
        padding: 1.2rem 1.25rem;
        vertical-align: middle;
        border-top: 1px solid var(--theme-border-light);
        color: var(--theme-text-dark); 
        font-weight: 500;
    }

    /* Vehicle Icon in the first column for visual interest */
    .vehicle-row-icon {
        color: var(--theme-primary-blue);
        font-size: 1.1rem;
        margin-right: 10px;
    }

    /* Action Buttons within the table */
    .btn-table-action {
        padding: 0.5rem; /* Square-ish buttons for icons */
        font-size: 1rem;
        border-radius: 4px;
        transition: all 0.2s ease;
        line-height: 1; /* Center the icon perfectly */
    }

    /* Delete Button (Danger Red - Icon Only) */
    .btn-delete {
        background-color: #fcebeb; /* Very light red background */
        border: 1px solid #f8d0cf;
        color: var(--theme-danger-red);
    }

    .btn-delete:hover {
        background-color: var(--theme-danger-red); 
        border-color: var(--theme-danger-red);
        color: #fff;
        transform: scale(1.05);
    }

    /* Alert for no vehicles found (Blue Accent) */
    .alert-no-vehicles {
        background-color: #EBF5FB; /* Very light blue background */
        color: var(--theme-dark-blue);
        border: 1px solid #D6EAF8;
        padding: 2.5rem; 
        border-radius: 8px;
        text-align: center;
        margin-top: 40px;
        font-size: 1.1rem;
    }

    .alert-no-vehicles .alert-heading {
        color: var(--theme-dark-blue);
        font-weight: 700;
        margin-bottom: 10px;
        font-size: 1.8rem;
    }
</style>

<div class="container vehicles-main-card">
    <div class="header-block">
        <i class="bi bi-car-front header-icon"></i>
        <h2>My Registered Vehicles</h2>
        <p>View, manage, or add new vehicles to your insurance portfolio.</p>
    </div>

    <div class="d-flex justify-content-end mb-4">
        <a asp-controller="Vehicle" asp-action="Add" class="btn btn-add-vehicle">
            <i class="bi bi-plus-lg"></i> Add New Vehicle
        </a>
    </div>

    @* Display Success/Error Messages from TempData *@
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Registration Number</th>
                        <th>Make</th>
                        <th>Model</th>
                        <th>Year</th>
                        <th>Type</th>
                        <th class="text-center">Action</th> @* Center the Action header *@
                    </tr>
                </thead>
                <tbody>
                    @foreach (var v in Model)
                    {
                        <tr>
                            <td><i class="bi bi-truck vehicle-row-icon"></i> @v.registrationNumber</td>
                            <td>@v.make</td>
                            <td>@v.model</td>
                            <td>@v.yearOfManufacture</td>
                            <td>@v.vehicleType.ToString()</td>
                            <td class="text-center">
                                @* We are using a client-side confirm before form submission for deletion *@
                                <form asp-action="Delete" asp-route-vehicleId="@v.vehicleId" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this vehicle? This action cannot be undone.');">
                                    <button type="submit" class="btn btn-table-action btn-delete" title="Delete Vehicle">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="alert alert-no-vehicles" role="alert">
            <h4 class="alert-heading"><i class="bi bi-info-circle-fill me-2"></i> No Vehicles Registered!</h4>
            <p>You currently do not have any active vehicles associated with your insurance profile.</p>
            <p class="mb-0 mt-3">Click the **Add New Vehicle** button to register your first one and manage its policies.</p>
        </div>
    }
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
